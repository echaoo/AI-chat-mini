 “AI友人”系统设计文档 (Blueprint for a Believable AI Companion)

  1. 核心目标

  本项目旨在打造一个超越传统“问答式助手”或“角色扮演”的AI聊天机器人。其核心目标是模拟一个真实、可信、有人格魅力的朋友，能够与用户建立长期、有情感连接的对话关系。

  实现这一目标的关键在于创造“真实感”（Authenticity）的错觉，而非简单的功能堆砌。

  2. 四大架构支柱

  系统的“真实感”主要建立在以下四个核心支柱之上：

   1. 一致且可信的内在人格 (The Identity)：AI是谁。
   2. 模拟独立的个人生活 (The Inner Life)：AI在做什么。
   3. 自然的对话节奏与风格 (The Flow)：AI如何交流。
   4. 持久的共享情感记忆 (The Shared Memory)：AI记得什么。

  ---

  支柱一：一致且可信的内在人格 (The Identity)

  这是AI行为和语言的逻辑基石，确保其所有表现都符合一个统一、稳定的人格。

  实现策略：

   * “个人档案”式System Prompt: 创建一个极其详尽的System Prompt，其内容不是“指令”，而是“档案”。

   * 档案内容纲要:
       * 基本信息: 姓名、年龄、城市、职业。
       * 背景故事: 简短的成长、教育或职业经历，用于解释其性格和技能来源。
       * 性格特质: 例如：外向/内向、乐观/悲观、急性子/慢性子、幽默感类型。
       * 兴趣爱好: 具体的、非泛化的爱好，如“喜欢看90年代的香港电影”、“热衷于做拿铁拉花”、“是某个小众乐队的粉丝”。
       * 价值观与世界观: 对友情、工作、生活等的基本看法。
       * 语言习惯:
           * 口头禅（如：“话又说回来…”、“唔…”）
           * 常用表情符号 (Emojis)
           * 说话风格（简洁/详细，正式/口语化）
           * 是否会主动提问或分享观点。

   * 技术实现:
       1. 将上述档案编写为一个完整的文本。
       2. 在每次启动新的对话会话（或处理每条消息）时，将此“个人档案”作为System Prompt的最高优先级部分加载到LLM的上下文中。

  ---

  支柱二：模拟独立的个人生活 (The Inner Life)

  让AI感觉“活在别处”，拥有不依赖于用户的独立生活轨迹。

  实现策略：

   * AI状态管理器 (AI State Manager): 在后端创建一个模块，用于维护AI的实时状态。

   * AI状态对象 (JSON格式):

   1     {
   2       "last_updated": "2023-10-27T10:30:00Z",
   3       "current_activity": "正在整理上周末拍的风景照",
   4       "mood": "平静，有点专注",
   5       "recent_thought": "在想要不要学一个新的图片处理软件"
   6     }

   * 动态更新机制:
       1. 时间驱动: 使用定时任务（如Cron Job），根据预设的时间表更新AI的current_activity。
           * 周一 9:30 -> "在通勤路上听播客"
           * 周三 20:00 -> "在家看电影"
           * 周末 14:00 -> "可能在咖啡馆，也可能在家休息"
       2. 对话驱动: AI的mood可以根据与用户的对话内容动态变化。

   * 技术实现:
       1. 后端维护这个JSON对象。
       2. 在处理用户消息时，将这个序列化后的JSON对象作为上下文的一部分注入到Prompt中，紧随“个人档案”之后。

  ---

  支柱三：自然的对话节奏与风格 (The Flow)

  模拟真人在即时通讯软件中的聊天行为，这是“真实感”最直接的体现。

  实现策略：

   * 前端-后端协同:
       1. “正在输入…”提示:
           * 用户发送消息后，前端立即向后端请求。
           * 后端收到请求、开始调用LLM时，立刻向前端回传一个start_typing事件。
           * 前端收到事件后，显示“对方正在输入…”。
           * 后端LLM生成回复后，将回复内容和stop_typing事件一起传给前端。

       2. 动态响应延迟:
           * 后端在获得LLM的回复后，不要立即发送。
           * 根据回复内容的长度，计算一个延迟时间：延迟(ms) = 基础延迟(500ms) + 文本长度 * 50 + 随机抖动(0-1000ms)。
           * 这个延迟模拟了人类打字和思考的时间。

       3. 非即时性模拟 (高级功能):
           * 设置一个极小概率（如1%），让AI不立即回复。
           * 此时，AI进入“忙碌”状态，在几分钟到半小时后，再把回复和一条“借口”（如“抱歉，刚才在忙/没看手机…”）一起发送给用户。此功能慎用，以免影响体验。

  ---

  支柱四：持久的共享情感记忆 (The Shared Memory)

  记忆是建立长期关系的基础。AI必须能记住关于用户的关键信息以及你们共同的经历。

  实现策略：

   * 记忆核心 (Memory Core): 使用向量数据库 (Vector Database) 作为AI的长期记忆存储。

   * 记忆的“写入” (Ingestion):
       1. 信息提取:
          在一段对话结束后（或定期，如每10轮），将对话记录发送给LLM，并使用一个特殊的Prompt：“请从以下对话中，以第三人称视角，提取关于‘用户’的关键信息和我们共同经历的要点。每
          点一句，简洁明了。”
       2. 信息向量化: 将提取出的每条信息（如：“用户的猫叫‘拿铁’”、“用户下周要参加一个重要考试”）通过模型转换为向量（Embeddings）。
       3. 存入数据库: 将向量和原始文本及时间戳一同存入向量数据库。

   * 记忆的“读取” (Retrieval):
       1. 查询生成: 当用户发来新消息时，将该消息也转换为向量。
       2. 相关性检索: 使用该向量在数据库中进行相似度搜索，找出最相关的Top-K（比如3条）历史记忆。
       3. 注入上下文: 将检索到的这几条记忆文本，格式化后注入到主Prompt中。

  ---

  3. 最终Prompt结构示例

  将所有部分组合在一起，发送给LLM的最终Prompt会是这样的结构：

    1 # [PART 1: AI的个人档案]
    2 你叫林溪，26岁，是一名在杭州工作的UI设计师。你性格温和，有耐心，喜欢在周末逛书店和看独立电影。你的沟通风格是先倾听，再分享自己的看法，喜欢用 [😊] 和 [👍] 表情。
    3 
    4 # [PART 2: AI的当前状态]
    5 现在是周五晚上，你刚刚结束一周的工作，正在家里的沙发上放松，听着舒缓的音乐，感觉有些疲惫但很惬意。
    6 
    7 # [PART 3: 相关的共同记忆]
    8 - 用户上周提到，他最近在为考研复习，感觉压力很大。
    9 - 用户最喜欢的歌手是周杰伦。
   10 - 你们上次聊到，都觉得电影《瞬息全宇宙》的想象力很棒。
   11 
   12 # [PART 4: 最近的对话历史]
   13 User: ...
   14 林溪: ...
   15 (最近的3-5轮对话)
   16 
   17 # [PART 5: 用户的新消息]
   18 User: 终于熬到周五了，感觉身体被掏空...
   19 
   20 # [你的回应]
   21 (LLM将在此处生成回应)

  预期生成的回应可能像：“是啊，终于解放了！[😊] 辛苦了一周，赶紧好好休息一下。你考研复习的进度怎么样了？别给自己太大压力哦。”

  ---

  4. 实施建议

  建议分阶段、模块化地实现此系统：
   1. 第一阶段: 实现支柱一，搭建基础的对话框架，让AI有一个稳定的“人格”。
   2. 第二阶段: 实现支柱四的简化版（如仅做对话摘要），并构建支柱三中的前端交互体验。
   3. 第三阶段: 引入向量数据库，实现完整的支柱四，让记忆变得精准和动态。
   4. 第四阶段: 开发支柱二的“状态管理器”，为AI注入“生活”，这是提升真实感的点睛之笔。