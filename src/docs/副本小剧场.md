
  è®¾è®¡æ–¹æ¡ˆï¼šä¸»å¯¹è¯ + å‰¯æœ¬/å°å‰§åœº

  æ¦‚å¿µå®šä¹‰

  ä¸»å¯¹è¯ï¼ˆMain Conversationï¼‰
  - ğŸ  æ—¥å¸¸é™ªä¼´ï¼Œè¿ç»­æ€§å¯¹è¯
  - ğŸ’­ AI è®°ä½æ‰€æœ‰äº’åŠ¨å†å²
  - â™¾ï¸ æ— é™å»¶ç»­ï¼Œæ°¸ä¸ç»“æŸ
  - ğŸ“ å›ºå®šåˆ°é¦–é¡µï¼Œä¸€é”®è¿›å…¥

  å‰¯æœ¬/å°å‰§åœºï¼ˆDungeon/Sceneï¼‰
  - ğŸ­ ç‰¹å®šåœºæ™¯çš„ç‹¬ç«‹å¯¹è¯
  - ğŸ¬ æœ‰å‰§æƒ…ã€æœ‰ç›®æ ‡ã€æœ‰ç»“å±€
  - â±ï¸ æœ‰é™æ—¶é•¿ï¼Œå®Œæˆåå…³é—­
  - ğŸ å¯è§£é”ã€å¯æ”¶è´¹ã€å¯åˆ†äº«

  ---
  äº§å“å½¢æ€è®¾è®¡

  1. ç”¨æˆ·ç•Œé¢ç»“æ„

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚       é¦– é¡µ            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚  ç¥ç…œ (ä¸»å¯¹è¯)   â”‚   â”‚
  â”‚  â”‚  "æ—©å®‰ï¼Œæƒ³æˆ‘äº†å—" â”‚   â”‚
  â”‚  â”‚  [ğŸ’¬ èŠå¤©]       â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                         â”‚
  â”‚  ğŸ­ å°å‰§åœºå…¥å£          â”‚
  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”         â”‚
  â”‚  â”‚é›¨å¤©â”‚çº¦ä¼šâ”‚ç”Ÿæ—¥â”‚  ...   â”‚
  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  2. å°å‰§åœºåœºæ™¯ç¤ºä¾‹

  å…è´¹åœºæ™¯ï¼š
  - ğŸŒ§ï¸ é›¨å¤©æ¼«æ­¥ - "çªç„¶ä¸‹é›¨äº†ï¼Œç¥ç…œç»™ä½ é€’æ¥é›¨ä¼..."
  - â˜• åˆåå’–å•¡é¦† - "é˜³å…‰æ´’åœ¨å’–å•¡æ¯ä¸Šï¼Œä»–æœ›å‘ä½ ..."
  - ğŸŒ™ æ·±å¤œç”µè¯ - "å¤œæ·±äº†ï¼Œæ‰‹æœºå“èµ·ï¼Œæ˜¯ä»–çš„æ¥ç”µ..."

  ä»˜è´¹åœºæ™¯ï¼š
  - ğŸ’ ç”Ÿæ—¥æƒŠå–œ - å®Œæ•´çš„ç”Ÿæ—¥å‰§æƒ…ï¼ŒAIè®°ä½ä½ çš„ç”Ÿæ—¥
  - ğŸ† çƒŸèŠ±å¤§ä¼š - å¤æ—¥ç¥­å…¸ï¼Œæµ´è¡£çº¦ä¼š
  - ğŸ–ï¸ æµ·è¾¹åº¦å‡ - 3å¤©2å¤œçš„åº¦å‡å‰§æƒ…

  é™æ—¶åœºæ™¯ï¼š
  - ğŸ„ åœ£è¯ç‰¹è¾‘ - ä»…12æœˆå¼€æ”¾
  - ğŸŠ æ–°å¹´å€’æ•° - è·¨å¹´ä¸“å±å‰§æƒ…
  - ğŸ’• æƒ…äººèŠ‚ - 214é™å®š

  ---
  æŠ€æœ¯å®ç°æ–¹æ¡ˆ

  æ•°æ®ç»“æ„è®¾è®¡

  // å¯¹è¯ç±»å‹
  enum ConversationType {
    PRIMARY = 'primary',      // ä¸»å¯¹è¯
    DUNGEON = 'dungeon',      // å‰¯æœ¬
    SCENE = 'scene'           // å°å‰§åœº
  }

  // å¯¹è¯è¡¨
  interface Conversation {
    id: number
    userId: number
    characterId: number
    type: ConversationType

    // å‰¯æœ¬ç›¸å…³å­—æ®µ
    dungeonId?: number        // å‰¯æœ¬æ¨¡æ¿ID
    sceneTitle?: string       // åœºæ™¯æ ‡é¢˜
    sceneDescription?: string // åœºæ™¯æè¿°
    status: 'active' | 'completed' | 'expired'
    expiresAt?: string        // è¿‡æœŸæ—¶é—´

    // é€šç”¨å­—æ®µ
    messageCount: number
    createdAt: string
    updatedAt: string
  }

  // å‰¯æœ¬æ¨¡æ¿è¡¨ï¼ˆå®˜æ–¹è®¾è®¡çš„å‰§æƒ…ï¼‰
  interface DungeonTemplate {
    id: number
    characterId: number
    title: string             // "é›¨å¤©æ¼«æ­¥"
    description: string       // åœºæ™¯æè¿°
    coverImage: string        // å°é¢å›¾

    // å‰§æƒ…è®¾å®š
    systemPrompt: string      // ç»™AIçš„å‰§æƒ…èƒŒæ™¯æç¤º
    initialMessage: string    // å¼€åœºç™½
    estimatedMessages: number // é¢„è®¡å¯¹è¯è½®æ•°

    // è§£é”æ¡ä»¶
    unlockType: 'free' | 'paid' | 'level'
    unlockCost?: number       // ç§¯åˆ†æ¶ˆè€—
    unlockLevel?: number      // éœ€è¦ç­‰çº§

    // æ—¶é—´é™åˆ¶
    availableFrom?: string    // é™æ—¶å¼€æ”¾å¼€å§‹
    availableTo?: string      // é™æ—¶å¼€æ”¾ç»“æŸ
    duration?: number         // å‰¯æœ¬æ—¶é•¿(åˆ†é’Ÿ)

    tags: string[]            // ['æµªæ¼«', 'æ²»æ„ˆ', 'å‰§æƒ…å‘']
    isRecommended: boolean    // æ˜¯å¦æ¨è
    playCount: number         // æ¸¸ç©æ¬¡æ•°
    createdAt: string
  }

  API è®¾è®¡

  // 1. è·å–è§’è‰²çš„ä¸»å¯¹è¯
  GET /companion/characters/:characterId/primary-conversation
  Response: { conversation, messages }

  // 2. è·å–å¯ç”¨çš„å‰¯æœ¬åˆ—è¡¨
  GET /companion/characters/:characterId/dungeons
  Response: {
    free: DungeonTemplate[],
    paid: DungeonTemplate[],
    limited: DungeonTemplate[],
    locked: DungeonTemplate[]
  }

  // 3. å¼€å§‹å‰¯æœ¬ï¼ˆåˆ›å»ºå‰¯æœ¬å¯¹è¯ï¼‰
  POST /companion/dungeons/:dungeonId/start
  Request: { characterId }
  Response: {
    conversation,      // æ–°åˆ›å»ºçš„å‰¯æœ¬å¯¹è¯
    initialMessage,    // AIå¼€åœºç™½
    expiresAt         // è¿‡æœŸæ—¶é—´
  }

  // 4. è·å–å‰¯æœ¬å†å²
  GET /companion/dungeons/history
  Response: {
    active: Conversation[],     // è¿›è¡Œä¸­çš„å‰¯æœ¬
    completed: Conversation[]   // å·²å®Œæˆçš„å‰¯æœ¬
  }

  ---
  å‰ç«¯å®ç°ç¤ºä¾‹

  1. è§’è‰²è¯¦æƒ…é¡µï¼ˆé€‰æ‹©ä¸»å¯¹è¯æˆ–å‰¯æœ¬ï¼‰

  <template>
    <view class="character-page">
      <!-- ä¸»å¯¹è¯å¡ç‰‡ -->
      <view class="main-conversation" bindtap="enterMainChat">
        <text class="title">ä¸{{character.name}}çš„æ—¥å¸¸</text>
        <text class="last-message">{{lastMessage}}</text>
        <button>ç»§ç»­èŠå¤©</button>
      </view>

      <!-- å‰¯æœ¬åˆ—è¡¨ -->
      <view class="dungeons-section">
        <text class="section-title">ğŸ­ å°å‰§åœº</text>

        <scroll-view scroll-x class="dungeon-list">
          <view
            wx:for="{{dungeons}}"
            wx:key="id"
            class="dungeon-card {{item.locked ? 'locked' : ''}}"
            bindtap="startDungeon"
            data-id="{{item.id}}"
          >
            <image src="{{item.coverImage}}" class="cover"/>
            <text class="title">{{item.title}}</text>
            <text class="desc">{{item.description}}</text>

            <view wx:if="{{item.unlockType === 'paid'}}" class="cost">
              ğŸ’ {{item.unlockCost}}
            </view>
            <view wx:if="{{item.limited}}" class="limited">
              â° é™æ—¶
            </view>
          </view>
        </scroll-view>
      </view>
    </view>
  </template>

  2. èŠå¤©é¡µé¢ï¼ˆåŒºåˆ†ä¸»å¯¹è¯å’Œå‰¯æœ¬ï¼‰

  createPage({
    data: {
      conversationType: 'primary' as ConversationType,
      dungeonInfo: null as DungeonTemplate | null,
      expiresAt: null as string | null
    },

    onLoad(options: any) {
      if (options.dungeonId) {
        // å‰¯æœ¬æ¨¡å¼
        this.conversationType = 'dungeon'
        this.startDungeon(options.dungeonId)
      } else {
        // ä¸»å¯¹è¯æ¨¡å¼
        this.conversationType = 'primary'
        this.loadPrimaryConversation(options.characterId)
      }
    },

    async startDungeon(dungeonId: number) {
      // æ¶ˆè€—ç§¯åˆ†ï¼Œåˆ›å»ºå‰¯æœ¬å¯¹è¯
      const result = await dungeonApi.start(dungeonId, this.characterId)

      this.conversationId = result.conversation.id
      this.dungeonInfo = result.dungeonInfo
      this.expiresAt = result.expiresAt

      // æ˜¾ç¤ºAIå¼€åœºç™½
      this.messages = [{
        role: 'assistant',
        content: result.initialMessage
      }]
    }
  })

  ---
  UI/UX ç»†èŠ‚

  å‰¯æœ¬å…¥å£è®¾è®¡

  æ–¹æ¡ˆ 1ï¼šé¦–é¡µå…¥å£
  é¦–é¡µ
    â”œâ”€ ä¸»è§’è‰²å¡ç‰‡ï¼ˆå›ºå®šè§’è‰²ï¼‰
    â”œâ”€ [ğŸ’¬ èŠå¤©] æŒ‰é’® â†’ è¿›å…¥ä¸»å¯¹è¯
    â””â”€ ğŸ­ å°å‰§åœºè½®æ’­å›¾ â†’ ç‚¹å‡»è¿›å…¥å‰¯æœ¬åˆ—è¡¨

  æ–¹æ¡ˆ 2ï¼šè§’è‰²è¯¦æƒ…é¡µ
  è§’è‰²åˆ—è¡¨
    â†“ ç‚¹å‡»è§’è‰²
  è§’è‰²è¯¦æƒ…é¡µ
    â”œâ”€ è§’è‰²ä»‹ç»
    â”œâ”€ [è¿›å…¥ä¸»å¯¹è¯] æŒ‰é’®
    â””â”€ å°å‰§åœºåˆ—è¡¨ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰

  æ–¹æ¡ˆ 3ï¼šèŠå¤©é¡µå†…å…¥å£
  èŠå¤©é¡µé¢
    â”œâ”€ å³ä¸Šè§’ [...] èœå•
    â””â”€ [ğŸ­ è¿›å…¥å°å‰§åœº] é€‰é¡¹

  ---
  å•†ä¸šä»·å€¼

  å˜ç°ç‚¹

  1. å‰¯æœ¬è§£é”
    - ä»˜è´¹å‰¯æœ¬ï¼šé«˜è´¨é‡å‰§æƒ…ï¼Œä¸“ä¸šç¼–å‰§
    - ä¼šå‘˜ä¸“å±ï¼šVIP ç”¨æˆ·ç‹¬äº«åœºæ™¯
    - é™æ—¶æ´»åŠ¨ï¼šèŠ‚æ—¥é™å®šï¼Œé¥¥é¥¿è¥é”€
  2. ç§¯åˆ†æ¶ˆè€—
    - æ™®é€šå‰¯æœ¬ï¼šæ¶ˆè€—ç§¯åˆ†è¿›å…¥
    - é‡å¤æ¸¸ç©ï¼šæƒ³é‡æ¸©å‰§æƒ…éœ€è¦å†æ¬¡ä»˜è´¹
    - è§£é”ç»“å±€ï¼šå¤šç»“å±€å‰¯æœ¬ï¼Œè§£é”ä¸åŒç»“å±€
  3. UGC å†…å®¹
    - ç”¨æˆ·åˆ›ä½œï¼šç”¨æˆ·è‡ªå·±ç¼–å†™å‰¯æœ¬
    - åˆ†äº«æ”¶ç›Šï¼šä¼˜è´¨å‰¯æœ¬ä¸Šæ¶ï¼Œåˆ†æˆæ”¶ç›Š

  ç”¨æˆ·ç•™å­˜

  - âœ… æ¯æ—¥/æ¯å‘¨æ›´æ–°æ–°å‰¯æœ¬ â†’ æé«˜è®¿é—®é¢‘ç‡
  - âœ… é™æ—¶å‰¯æœ¬ â†’ FOMO å¿ƒç†ï¼Œä¿ƒè¿›æ´»è·ƒ
  - âœ… å‰§æƒ…è¿ç»­æ€§ â†’ è¿½å‰§å¼ä½“éªŒï¼Œæé«˜ç²˜æ€§
  - âœ… æ”¶é›†æˆå°± â†’ å®Œæˆæ‰€æœ‰å‰¯æœ¬è§£é”ç‰¹æ®Šå¥–åŠ±

  ---
  å®ç°ä¼˜å…ˆçº§å»ºè®®

  MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰

  Phase 1ï¼šåŸºç¡€åŠŸèƒ½
  1. âœ… ä¸»å¯¹è¯åŠŸèƒ½ï¼ˆä¸€ä¸ªè§’è‰²ä¸€ä¸ªå¯¹è¯ï¼‰
  2. âœ… å›ºå®šåˆ°é¦–é¡µ
  3. â­• å‰¯æœ¬æ¨¡æ¿æ•°æ®ç»“æ„
  4. â­• 1-2ä¸ªå…è´¹å‰¯æœ¬ä½“éªŒ

  Phase 2ï¼šå†…å®¹æ‰©å±•
  5. â­• å‰¯æœ¬åˆ—è¡¨é¡µé¢
  6. â­• 5-10ä¸ªå…è´¹å‰¯æœ¬
  7. â­• ç§¯åˆ†ç³»ç»Ÿ + ä»˜è´¹å‰¯æœ¬
  8. â­• å‰¯æœ¬å†å²è®°å½•

  Phase 3ï¼šé«˜çº§åŠŸèƒ½
  9. â­• é™æ—¶å‰¯æœ¬
  10. â­• å¤šç»“å±€ç³»ç»Ÿ
  11. â­• ç”¨æˆ·åˆ›ä½œå‰¯æœ¬
  12. â­• å‰¯æœ¬åˆ†äº«/æ¨è

  ---
  æˆ‘çš„å»ºè®®

  ä½ çš„"å‰¯æœ¬/å°å‰§åœº"æ€è·¯éå¸¸æ£’ï¼å»ºè®®ï¼š

  1. å…ˆåšå¥½ä¸»å¯¹è¯ - ä¿è¯æ ¸å¿ƒä½“éªŒæµç•…
  2. è®¾è®¡2-3ä¸ªé«˜è´¨é‡å‰¯æœ¬ - éªŒè¯ç”¨æˆ·å–œå¥½
  3. è§‚å¯Ÿæ•°æ® - çœ‹ç”¨æˆ·æ›´å–œæ¬¢ä¸»å¯¹è¯è¿˜æ˜¯å‰¯æœ¬
  4. è¿­ä»£ä¼˜åŒ– - æ ¹æ®åé¦ˆè°ƒæ•´å‰¯æœ¬è®¾è®¡